---
title: "Analisis muestras para estima factores a y b pelágicos"
author: "mkorta"
content: "Script to estimate a&b factor in LWR after IEO and AZTI agreement"
date:  "February 2021"
output: 
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
    toc_float: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width=12, fig.height=8)
```

# Background

El año 2020 ha sido inusual en cuanto al muestreo debido a la COVID19. EL IEO disponen de muy pocos muestreos biológicos; de manera que vamos ver si AZTI cubre el año con los muestreos. Si fuera así podrían calcularse con los datos de AZTI y si no habría que decidir si aplicamos las LWR del año pasado.  

# Resumen 

* AZTI tiene similar covertura que el año 2019.


```{r echo=F, message=FALSE, warning=FALSE}

library(ggplot2)
library(lubridate)
library(dplyr)
library(tidyr)
library(ggthemes)
#library(FSA)
library(kableExtra)
theme_set(theme_bw(base_size=12))
```

# Datos 

```{r echo=F, message=FALSE, warning=FALSE}

dat <- read.csv(file.path(getwd(),"Data/all_2020.csv"), header=T, sep=";", dec=",")
aux <- read.csv(file.path(getwd(),"Data/all_2019.csv"), header=T, sep=";", dec="," )

#names(dat)
#names(aux)

dat <- rbind(dat, aux)

dat$fecha <- dat$FechaVenta
dat$fecha <- as.Date(dat$fecha, format="%d/%m/%Y")
dat$M <- as.factor(month(dat$fecha)) 
dat$Q <- as.factor(quarter(dat$fecha))
dat$S <- as.factor(semester(dat$fecha)) 
dat$Y <- as.factor(year(dat$fecha)) 

dat <- subset (dat, !Especie.ALFA3 %in% c("HKE", "MEG", "ANK"))
dat$Especie.ALFA3 <- factor(dat$Especie.ALFA3)
dat$NombreZona[dat$NombreZona == "27.8.c.e"] <- "27.8.c"
dat$NombreZona <- factor(dat$NombreZona)
# str(dat)
# head(dat)
# summary(dat)
```

## Numero de muestras y zonas

```{r echo=F, message=FALSE, warning=FALSE}

wide <-dat %>% group_by (Y, NombreZona, Especie.ALFA3)%>% count(Y)
pivot_wider(wide, names_from = Y, values_from = n) %>% 
  kbl(caption = "Número de individuos medidos por especie y zona. Comparación 2019-2020") %>%
  kable_classic(full_width = T, html_font = "Cambria")

```

## Solo FRESCO

```{r echo=F, message=FALSE, warning=FALSE}

dat <- subset(dat, NombreEstado == "Fresco")
wide <-dat %>% group_by (Y, NombreZona, Especie.ALFA3)%>% count(Y)
pivot_wider(wide, names_from = Y, values_from = n)%>% 
  kbl(caption = "Número de individuos medidos en <Fresco> por especie y zona. Comparación 2019-2020") %>%
  kable_classic(full_width = T, html_font = "Cambria") 
```

## Distribucion temporal 

```{r echo=F, message=FALSE, warning=FALSE}

ggplot(dat, aes(Y, fill=S))+
  geom_bar(position = "dodge2")+
  scale_fill_colorblind()+
  ylab("Number of observations")+
  facet_grid(Especie.ALFA3~NombreZona, scales = "free")

ggplot(dat, aes(Y, fill=Q))+
  geom_bar()+
  scale_fill_colorblind()+
  ylab("Number of observations")+
  facet_grid(Especie.ALFA3~NombreZona, scales = "free")
```


```{r echo=F, message=FALSE, warning=FALSE}
#sessionInfo()
```




